<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>JVM性能监控与故障处理工具 | jwcqc个人笔记</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JVM性能监控与故障处理工具</h1><a id="logo" href="/.">jwcqc个人笔记</a><p class="description">年华虚度 空有一身疲惫</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JVM性能监控与故障处理工具</h1><div class="post-meta">Nov 24, 2016<span> | </span><span class="category"><a href="/categories/JVM/">JVM</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>HotSpot虚拟机提供了许多虚拟机运行时调试工具，方便开发人员在应用运行时对虚拟机和应用性能进行监控和优化。</p>
<h3 id="jps：JVM-Process-Status-Tool"><a href="#jps：JVM-Process-Status-Tool" class="headerlink" title="jps：JVM Process Status Tool"></a>jps：JVM Process Status Tool</h3><p>显示指定系统内所有的HotSpot 虚拟机进程。并显示虚拟机执行主类（Main Class, main（）函数所在的类）的名称，以及这些进程的本地虚拟机的唯一ID ( LVMID, Local Virtual Machine Identifier）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps 命令格式：jps [ options ] [ hostid ]</div></pre></td></tr></table></figure>
<p>主要参数选项:<br>-q：只输出LVMID ，省略主类的名称<br>-m：输出虚拟机进程启动时传递给主类main（）函数的参数<br>-l：输出主类的全各，如果选程执行的是Jar 包，输出Jar 始径<br>-v：输出虚拟机进程启动时JVM 参数  </p>
<h3 id="jstat：JVM-Statistics-Monitoring-Tool"><a href="#jstat：JVM-Statistics-Monitoring-Tool" class="headerlink" title="jstat：JVM Statistics Monitoring Tool"></a>jstat：JVM Statistics Monitoring Tool</h3><p>用于收集HotSpot 虚拟机各方面的运行数据。可以显示本地或远程虚拟机进程中的类装载、内存、垃圾收集、JIT 编译等运行数据。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat 命令格式为：jstat [ option vmid [internal [s | ms] [count]] ]</div></pre></td></tr></table></figure>
<p>主要参数选项<br>-class：监视类装载、卸载数量、总空间及类装载在所耗费的时间<br>-gc    ：监视Java堆状况，Eden区、2个survivor 区、老年代、永久代等的容最、已用空间、GC 时间合计等信息<br>-gccapacity   ：监视内容与－gc 基本相同，但输出主要关注Java 堆各个区域使用到的最大和最小空间<br>-gcutil   ：监视内容与－gc 慕本相同，但输出主要关注已使用空间占总空间的百分比<br>-gccause：与－gcutil 功能一样．但是会额外输出导致上一次GC 产生的原因<br>-gcnew：监视新生代GC 的状况<br>-gcnewcapacity：监视内容与－gcnew 基本相同，输出主要关注使用到的最大和最小空间<br>-gcold：视老年代GC 的状况<br>-gcoldcapacity：监视内容与－gcold 基本相同，输出主要关注使用到的最大和最小空间<br>-gcpermcapacity：输出永久代使用到的最大和最小空间<br>-compiler：输出JIT 编译器编译过的方法、娓时等信息<br>-printcompilation：输出已经被JIT 编译的方站  </p>
<h3 id="jinfo：Configuration-Info-for-Java"><a href="#jinfo：Configuration-Info-for-Java" class="headerlink" title="jinfo：Configuration Info for Java"></a>jinfo：Configuration Info for Java</h3><p>显示虚拟机配置信息。实时地查看和调整虚拟机的各项参数。不同操作系统支持程序不一样。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jinfo 命令格式：jinfo [ option ] pid</div></pre></td></tr></table></figure>
<h3 id="jmap：-Memory-Map-for-Java"><a href="#jmap：-Memory-Map-for-Java" class="headerlink" title="jmap： Memory Map for Java"></a>jmap： Memory Map for Java</h3><p>生成虚拟机的内存转储快照（heapdump 文件）。它还可以查询finalize 执行队列，Java堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器等。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap 命令格式：jmap [ option ] vmid</div></pre></td></tr></table></figure>
<p>-dump：生成Java 堆转储快照.格式为：－dump: [live,]format=b,file=&lt;filename＞，其中live子参数说明是否只dump 出存活的对象<br>-finalizerinfo：显示在F-Queue 中等待Finalizer 线程执行finalize 方法的对象． 只在Linux /Solaris 平台下有效<br>-heap：显示Java 堆详细信息，如使用哪种回收器、参数配置、分代状况等． 只在Linux/Solaris 平台下有效<br>-histo：显示堆中对象统计信息，包括类、实例数量和合计容量<br>-permstat：以ClassLoader 为统计口径显示永久代内存状态．只在Linux/Solaris 平台下有效<br>-F：当虚拟机进程对－dump 选项没有响应时，可使用这个选项强制生成dump 快照。只Linux/Solaris 平台下有效</p>
<h3 id="jhat：JVM-Heap-Dump-Browser"><a href="#jhat：JVM-Heap-Dump-Browser" class="headerlink" title="jhat：JVM Heap Dump Browser"></a>jhat：JVM Heap Dump Browser</h3><p>用于分析heapdump 文件，它会建立一个HTTP/HTML服务器， 让用户可以在浏览器上查看分析结果。常与jmap 搭配使用。</p>
<h3 id="jstack：Stack-Trace-for-Java"><a href="#jstack：Stack-Trace-for-Java" class="headerlink" title="jstack：Stack Trace for Java"></a>jstack：Stack Trace for Java</h3><p>显示虚拟机的线程快照。线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等。线程出现停顿的时候通过jstack 来查看各个钱程的调用堆栈，可以知道没有响应的线程在后台正什么事情，或者等待着什么资源。</p>
<h3 id="使用jconsole监控远程Linux-tomcat运行情况的配置"><a href="#使用jconsole监控远程Linux-tomcat运行情况的配置" class="headerlink" title="使用jconsole监控远程Linux tomcat运行情况的配置"></a>使用jconsole监控远程Linux tomcat运行情况的配置</h3><p>编辑tomcat/bin/catalina.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim catalina.sh</div></pre></td></tr></table></figure></p>
<p>在其中# —– Execute The Requested Command —————————————–”之前插入新的一行(中间没有换行)，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CATALINA_OPTS=&quot;-Djava.rmi.server.hostname=125.216.242.151 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=60001 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=true&quot;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意不要添加到JAVA_OPTS中，而是CATALINA_OPTS，否则开启jmx监控后关闭tomcat会提示Port already in use的问题<br>因为添加到JAVA_OPTS中的配置会在启动和关闭的时候都尝试运行，所以关闭tomcat的时候就会报端口已在使用的提示。</p>
</blockquote>
<p>编辑jmxremote.access和jmxremote.password<br>进入/usr/lib/jdk1.7.0_79/jre/lib/management（jdk设置的路径因人而异）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mv jmxremote.password.template jmxremote.password   </div><div class="line">chmod 600 jmxremote.access jmxremote.password  </div><div class="line">vim jmxremote.password</div></pre></td></tr></table></figure>
<p>由于密码是以明文的方式保存在jmxremote.password中，所以对此文件只能由所有者读取，其他人都不能读取。权限需要注意，600，即所有者有rw权限</p>
<p>如果需要添加用户</p>
<p>jmxremote.access 一般保持原始内容不变即可<br>对于jmxremote.password，将其中的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># monitorRole  QED</div><div class="line"># controlRole   R&amp;D</div></pre></td></tr></table></figure></p>
<p>井号注释取消掉，其中monitorRole为只拥有只读权限的角色，controlRole有更高权限：读写等等。</p>
<p>如果需要添加其他用户，需要在jmxremote.access也加上相应的权限，如添加admin用户：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">admin   readwrite \</div><div class="line">              create javax.management.monitor.*,javax.management.timer.* \</div><div class="line">              unregister</div></pre></td></tr></table></figure></p>
<p>具体jmxremote.access中都有解释</p>
<p>最后将端口加入防火墙信任列表，重新启动tomcat即可，我们在上面配置的jmx代理就会随tomcat一起启动</p>
<p>可以使用 netstat -an | grep 60001命令查看端口是否正常启动</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://jwcqc.me/2016/11/24/jvm-performance-monitor-and-tools/" data-id="cj06hhlyr00054sv853f0wpz8" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/12/06/jvm-runtime-memory-structure/" class="pre">Java虚拟机运行时内存结构</a><a href="/2016/11/04/naive-bayes/" class="next">机器学习经典算法-朴素贝叶斯(Naive Bayes)及其应用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://jwcqc.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/WebView/" style="font-size: 15px;">WebView</a> <a href="/tags/WebRTC/" style="font-size: 15px;">WebRTC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/wxpay-develop-process/">微信支付后台开发步骤</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/mongo-authentication/">MongoDB启用认证权限-记一次公网数据库被删经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/06/jvm-runtime-memory-structure/">Java虚拟机运行时内存结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/24/jvm-performance-monitor-and-tools/">JVM性能监控与故障处理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/04/naive-bayes/">机器学习经典算法-朴素贝叶斯(Naive Bayes)及其应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/11/mqtt-redis-achieve-single-account-login/">使用MQTT协议+Redis缓存实现APP登录顶号功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/26/apprtc-server-build-process/">AppRTC服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/18/vmware-network-configuration/">VMWare虚拟机网络配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/31/android-webview-performance-monitor/">Android WebView 页面性能监控实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/21/android-webview-development-notes/">Android WebView 开发使用笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://i-test.com.cn/" title="用户行为分析平台" target="_blank">用户行为分析平台</a><ul></ul><a href="https://i-test.com.cn/" title="WebRTC使用" target="_blank">WebRTC使用</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">jwcqc个人笔记.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>